---
import type { GetStaticPaths } from "astro";
import Pagination from "../components/control/Pagination.astro";
import { PAGE_SIZE } from "../constants/constants";
import MainGridLayout from "../layouts/MainGridLayout.astro";
import { getSortedPosts } from "../utils/content-utils";
import { formatDate, formatTime } from "../utils/date-utils";

export const getStaticPaths = (async ({ paginate }) => {
    const allBlogPosts = await getSortedPosts();

    // 过滤包含 "rant" 标签的文章
    const rantPosts = allBlogPosts.filter((post) => post.data.tags.includes("rant"));

    // 按发布日期排序 (最新优先)
    rantPosts.sort(
        (a, b) =>
            new Date(b.data.published).getTime() - new Date(a.data.published).getTime(),
    );

    // 每页显示 15 篇文章
    return paginate(rantPosts, { pageSize: 8 });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

const len = page.data.length;
---

<MainGridLayout easter={true}>
    <div class="flex flex-col">
        <!-- 标题卡片 -->
        <div class="title-box p-6 mb-8 onload-animation relative overflow-hidden" id="title-box">
            <!-- 背景层 -->
            <div class="title-box-bg"></div>
            <div class="title-box-nebula"></div>
            <div class="title-box-stars"></div>
            <div class="title-box-aurora"></div>
            <!-- 内容层 -->
            <div class="relative z-10">
                <!-- 标题：渐变 + 发光 + 闪烁 -->
                <h1 class="title-text text-3xl font-bold mb-3">吐槽</h1>
                <!-- 副标题：淡化 + 呼吸 + 斜体 + 英文装饰 -->
                <p class="subtitle-text text-white/70 leading-relaxed">
                    <span class="subtitle-cn">日常吐槽</span>
                    <span class="subtitle-divider"> · </span>
                    <span class="subtitle-en">Whispers in the Void</span>
                </p>
            </div>
            <!-- 鼠标光晕 -->
            <div class="title-box-glow"></div>
        </div>

        <!-- 文章列表 -->
        <div class="flex flex-col gap-4 mb-4">
            {page.data.map((post: any) => (
                <div class="rant-card onload-animation">
                    <!-- 时间线 -->
                    <div class="flex flex-col items-center min-w-[5rem] pr-4 border-r border-white/10">
                        <div class="text-xs font-medium text-white/90">{formatDate(new Date(post.data.published))}</div>
                        <div class="text-xs font-light text-white/50 mt-1">{formatTime(new Date(post.data.published))}</div>
                    </div>
                    <!-- 内容 -->
                    <div class="flex-1 p-2">
                        <div class="text-white/90 leading-relaxed whitespace-pre-wrap">
                            {post.body}
                        </div>
                    </div>
                </div>
            ))}
        </div>

        <!-- 分页 -->
        <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${(len)*50}ms)`}></Pagination>
    </div>

    <script is:inline>
        (function() {
            var titleBox = document.getElementById('title-box');
            var glow = titleBox ? titleBox.querySelector('.title-box-glow') : null;

            if (!titleBox || !glow) return;

            titleBox.addEventListener('mousemove', function(e) {
                var rect = titleBox.getBoundingClientRect();
                var x = e.clientX - rect.left;
                var y = e.clientY - rect.top;
                glow.style.left = x + 'px';
                glow.style.top = y + 'px';
            });

            titleBox.addEventListener('mouseleave', function() {
                glow.style.opacity = '0';
            });
        })();
    </script>
</MainGridLayout>
